package jp.wat.model;

import java.sql.ResultSet;
import java.sql.SQLException;

import jp.wat.entity.UserMaster;

public class userDAO {
	 
	   //会員情報マッピング（selectのためのマッピングです）
	   protected class MemberRowMapper {
	
	      public UserMaster getUserByKey(int id) throws SQLException {
	          UserMaster user = new UserMaster();
	          
	          //DB接続処理
	          initDao();
	          
	          //クエリー発行
	          
	          
	          //TODO
	          //DBクローズ処理
	          
	          return user;
	       }
	      
	      protected void initDao(){
	    	  //TODO DB接続処理
	      }
	     
	      
	      
	      
	      
	      
	   }
	 
	   //初期化
	   protected void initDao()
	   {
	      this.simpleTemplate = new SimpleJdbcTemplate(getDataSource());
	   }
	     
	   //selectサンプル
	   public List<Member> findMember(MemberSearchKey searchKey) {
	       //
	       String sql = "select * from t_member ";
	       String where = "";
	       if(searchKey.getId() != null){
	          where += " and id = :id";
	       }
	       if(searchKey.getName() != null){
	          where += " and name = :name";
	       }
	       if(searchKey.getAgeFrom() != -1){
	          where += " and age >= :ageFrom";
	       }
	       if(searchKey.getAgeTo() != -1){
	          where += " and age >= :ageTo";
	       }
	       if(!where.isEmpty()){
	          sql += " where " + where.substring(4);
	       }
	       
	       //会員リスト
	       List<Member> memberList = this.simpleTemplate.query(
	          sql, new MemberRowMapper(), new BeanPropertySqlParameterSource(searchKey)
	       ); 
	     
	       return memberList;
	   }
	   
	   //更新サンプル（insertも同じ）
	   public void updateMember(Member member){
	      Assert.hasText(member.getId());
	      
	      //SQL
	      String sql = "update member set name = :name, age = :age where id = :id";
	      
	      this.simpleTemplate.update(sql, new BeanPropertySqlParameterSource(member));
	   }
	   
	}
